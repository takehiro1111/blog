---
title: "Goにおける依存性の注入"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
![](/images/go/go_logo.png =450x)


```go:crud.go
type RandomGenerator interface {
	Intn(n int) int
}

type DefaultRandomGenerator struct {
	rand *rand.Rand
}

func NewDefaultRandomGenerator() *DefaultRandomGenerator {
	seed := time.Now().UnixNano()
	return &DefaultRandomGenerator{
		rand: rand.New(rand.NewSource(seed)),
	}
}

func (r *DefaultRandomGenerator) Intn(n int) int {
	return r.rand.Intn(n)
}

// GenerateId はゼロ埋めIDを生成します
func (ps *ProductStore) GenerateId() (int, string, error) {
	ps.nextId++
	jId := fmt.Sprintf("%03d", ps.nextId)

	pId, err := strconv.Atoi(jId)
	if err != nil {
		return 0, "", errors.NewCustomError(errors.InternalServerErr, "IDを文字列から数値に変換できませんでした")
	}

	return pId, jId, nil
}

// GenerateJanCode は指定されたIDを使用してJANコードを生成します
func (ps *ProductStore) GenerateJanCode(jId string) string {
	randNum := ps.randGen.Intn(900_000_000) + 100_000_000
	janCode := fmt.Sprintf("%d-%s", randNum, jId)
	return janCode
}

```

```go:main.go

// Product は商品管理システムの商品を表します
type Product struct {
	id            int
	name, janCode string
}

// ProductStore は商品のコレクションを管理します
type ProductStore struct {
	products []Product
	nextId   int
	randGen  RandomGenerator
}

// NewProductStore は新しいProductStoreインスタンスを作成して返します
func NewProductStore() *ProductStore {
	return &ProductStore{
		products: []Product{},
		nextId:   0,
		randGen:  NewDefaultRandomGenerator(),
	}
}

func main() {
	config := logger.Config{
		Level:  "INFO",
		Format: "TEXT",
	}
	logger := logger.New(config)
	ps := NewProductStore()
	ProcessProductManagement(ps, os.Stdin, logger)
}


```
